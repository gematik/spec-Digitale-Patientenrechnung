{
  "resourceType": "StructureDefinition",
  "id": "ergpkv-rechnungsworkflow",
  "url": "https://gematik.de/fhir/ergpkv/StructureDefinition/ergpkv-rechnungsworkflow",
  "name": "ERGPKVRechnungsworkflow",
  "title": "ERGPKV Rechnungsworkflow",
  "status": "draft",
  "fhirVersion": "4.0.1",
  "mapping": [
    {
      "identity": "workflow",
      "uri": "http://hl7.org/fhir/workflow",
      "name": "Workflow Pattern"
    },
    {
      "identity": "rim",
      "uri": "http://hl7.org/v3",
      "name": "RIM Mapping"
    },
    {
      "identity": "w5",
      "uri": "http://hl7.org/fhir/fivews",
      "name": "FiveWs Pattern Mapping"
    },
    {
      "identity": "v2",
      "uri": "http://hl7.org/v2",
      "name": "HL7 v2 Mapping"
    }
  ],
  "kind": "resource",
  "abstract": false,
  "type": "Task",
  "baseDefinition": "http://hl7.org/fhir/StructureDefinition/Task",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Task.extension",
        "path": "Task.extension",
        "comment": "Rechnungsempfänger:in oder Patient:in. Diese Person ist die Rechnungsempfänger:in und damit für die Handhanbung der Rechnung zuständig.",
        "min": 1
      },
      {
        "id": "Task.extension:rechnungsempfaenger",
        "path": "Task.extension",
        "sliceName": "rechnungsempfaenger",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Extension",
            "profile": [
              "http://hl7.org/fhir/5.0/StructureDefinition/extension-Task.requestedPerformer"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.identifier",
        "path": "Task.identifier",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "type"
            }
          ],
          "rules": "open"
        },
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.identifier:token",
        "path": "Task.identifier",
        "sliceName": "token",
        "comment": "Zufällig durch den Fachdienst generiertes Token zu eindeutigen Identifizierung einer E-Rechnung.",
        "min": 1,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Task.identifier:token.type",
        "path": "Task.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "RI",
              "system": "http://terminology.hl7.org/CodeSystem/v2-0203"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "Task.identifier:token.system",
        "path": "Task.identifier.system",
        "min": 1,
        "patternUri": "https://gematik.de/fhir/sid/ergpkv-token",
        "mustSupport": true
      },
      {
        "id": "Task.identifier:token.value",
        "path": "Task.identifier.value",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.status",
        "path": "Task.status",
        "comment": "Sobald eine Rechnung versendet wird durch die Leistungserbringer:in wird ein neuer Rechnungsworkflow angelegt. Vorläufige Rechnungen können nicht angelegt werden. Sobald die Rechnung durch die Rechnungsempfänger:in in die EPA oder die persönliche Ablagee verschoben wird, kann der Task als abgeschlossen gekennzeichnet werden.",
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/ValueSet/ergpkv-rechnungsworkflow-status-vs"
        }
      },
      {
        "id": "Task.businessStatus",
        "path": "Task.businessStatus",
        "comment": "Eine Rechnung kann zunächst durch das PVS der Leistungserbringer:in geprüft werden. Sobald eine Rechnung final übermittel wurde, erhält der Rechnungsworkflow den Status \"Neu\". Nach dem ersten Abruf einer Rechnung durch den Rechnungsempfänger wechselt der Status auf \"Offen\". Zudem wird der Status durch den Fachdienst erneut angepasst sobald die Rechnung oder ein Teil der Rechnung bei einem Kostenträger eingereicht wurde. Eine Rechnung kann manuell durch die Rechnungsempfänger:in als \"Erledigt\" gekennzeichnet werden (vgl. Task.status).",
        "min": 1,
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/ValueSet/ergpkv-rechnungsworkflow-businessStatus-vs"
        }
      },
      {
        "id": "Task.intent",
        "path": "Task.intent",
        "comment": "Der Rechnungsworkflow wird als \"Order\" gekennzeichnet, da die Leistungserbinger die Begleichung der Rechnung erwartet.",
        "patternCode": "order",
        "mustSupport": true
      },
      {
        "id": "Task.code",
        "path": "Task.code",
        "comment": "Der Fachdienst muss zwischen einem Rechnungsworkflow und einem Einreichungsworkflow unterscheiden.",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "rechnungsworkflow",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-workflow-cs"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "Task.requester",
        "path": "Task.requester",
        "comment": "Die Leistungserbringer:in wird eindeutig identifiziert durch eine Telematik-ID, diese kann entweder eine persönliche Telematik-ID sein (per HBA) oder für die geamte Organisation gelten (per SMC-B).",
        "min": 1,
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Organization",
              "http://hl7.org/fhir/StructureDefinition/Practitioner"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.requester.identifier",
        "path": "Task.requester.identifier",
        "min": 1,
        "type": [
          {
            "code": "Identifier",
            "profile": [
              "http://fhir.de/StructureDefinition/identifier-telematik-id"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input",
        "path": "Task.input",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "type"
            }
          ],
          "rules": "open"
        },
        "min": 4,
        "mustSupport": true
      },
      {
        "id": "Task.input:sonstigeDokumente",
        "path": "Task.input",
        "sliceName": "sonstigeDokumente",
        "comment": "Der Fachdienst extrahiert die Rechnungsanhänge der Rechnung um diese einzeln auffindbar zu machen.",
        "min": 0,
        "max": "*",
        "mustSupport": true
      },
      {
        "id": "Task.input:sonstigeDokumente.type",
        "path": "Task.input.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "sonstigeDokumente",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
        }
      },
      {
        "id": "Task.input:sonstigeDokumente.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/DocumentReference"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input:sonstigeDokumente.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.input:originalRechnung",
        "path": "Task.input",
        "sliceName": "originalRechnung",
        "comment": "Enthält die signierte Rechnung inkl. Rechnungsdetails, Rechnungspositionen, sowie PDF-Repräsentation. Der Fachdienst übernimmt die Rechnung ohne Veränderung aus dem System der Leistungserbringer:in.",
        "min": 1,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Task.input:originalRechnung.type",
        "path": "Task.input.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "originalRechnung",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
        }
      },
      {
        "id": "Task.input:originalRechnung.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Bundle"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input:originalRechnung.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnung",
        "path": "Task.input",
        "sliceName": "rechnung",
        "comment": "Der Fachdienst extrahiert die Rechnung um diese einzeln auffindbar zu machen.",
        "min": 1,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnung.type",
        "path": "Task.input.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "rechnung",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
        }
      },
      {
        "id": "Task.input:rechnung.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Bundle"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnung.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsposition",
        "path": "Task.input",
        "sliceName": "rechnungsposition",
        "comment": "Der Fachdienst extrahiert die Rechnungspositionen um diese einzeln auffindbar zu machen.",
        "min": 1,
        "max": "*",
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsposition.type",
        "path": "Task.input.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "rechnungsposition",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
        }
      },
      {
        "id": "Task.input:rechnungsposition.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Bundle"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsposition.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsdokument",
        "path": "Task.input",
        "sliceName": "rechnungsdokument",
        "comment": "Der Fachdienst extrahiert die PDF-Repräsentation der Rechnung um diese einzeln auffindbar zu machen.",
        "min": 1,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsdokument.type",
        "path": "Task.input.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "rechnungsposition",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-inputtype-cs"
        }
      },
      {
        "id": "Task.input:rechnungsdokument.value[x]",
        "path": "Task.input.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Binary"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.input:rechnungsdokument.value[x].reference",
        "path": "Task.input.value[x].reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Task.output",
        "path": "Task.output",
        "slicing": {
          "discriminator": [
            {
              "type": "pattern",
              "path": "type"
            }
          ],
          "rules": "open"
        },
        "mustSupport": true
      },
      {
        "id": "Task.output:tokenPdf",
        "path": "Task.output",
        "sliceName": "tokenPdf",
        "min": 0,
        "max": "1"
      },
      {
        "id": "Task.output:tokenPdf.type",
        "path": "Task.output.type",
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "tokenPdf",
              "system": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-outputtype-cs"
            }
          ]
        },
        "mustSupport": true,
        "binding": {
          "strength": "required",
          "valueSet": "https://gematik.de/fhir/ergpkv/CodeSystem/ergpkv-rechnungsworkflow-outputtype-cs"
        }
      },
      {
        "id": "Task.output:tokenPdf.value[x]",
        "path": "Task.output.value[x]",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://hl7.org/fhir/StructureDefinition/Binary"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Task.output:tokenPdf.value[x].reference",
        "path": "Task.output.value[x].reference",
        "min": 1,
        "mustSupport": true
      }
    ]
  }
}
